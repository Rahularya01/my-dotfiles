# Disable macOS software flow control so C-s works
run-shell "stty -ixon || true"

# Unbind the default prefix and rebind to C-s
unbind C-b
set -g prefix C-s
bind C-s send-prefix

# Reload config with “prefix + r”
unbind r
bind r source-file ~/.tmux.conf \; display-message "tmux.conf reloaded"

# Mouse support
set -g mouse on

# Use a true 256-color TERM inside tmux
set -g default-terminal "tmux-256color"
set-option -ga terminal-overrides ',xterm-256color:Tc'

# Status bar at the top
set-option -g status-position top

# TPM plugins including Gruvbox theme
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'z3z1ma/tmux-gruvbox'

# Gruvbox theme options
set -g @gruvbox_flavour 'dark'

# Initialize TPM (keep this at the bottom of tmux.conf)
run-shell '~/.tmux/plugins/tpm/tpm'

############
# Styling #
############

set -g status-style bg=#282828,fg=#ebdbb2  # Gruvbox dark background and foreground

# Inactive window style
setw -g window-status-format "\
#[bg=#3c3836,fg=#928374] #{window_index} \
#[bg=#504945,fg=#665c54,bold] #{window_name} \
#[fg=#504945,bg=#282828]"

# Active window style
setw -g window-status-current-format "\
#[bg=#3c3836,fg=#fabd2f,bold] #{window_index} \
#[bg=#fabd2f,fg=#282828,bold] #{window_name} \
#[fg=#fabd2f,bg=#282828]"

# Left/right status bars
set -g status-left-length 50
set -g status-left ""

set -g status-right-length 100
set -g status-right "\
#[fg=#b16286,bg=#282828]#[bg=#b16286,fg=#282828,bold]   #[bg=#282828,fg=#b16286,bold] #{session_name}  \
#[fg=#458588,bg=#282828]#[bg=#458588,fg=#282828,bold]   #[bg=#282828,fg=#458588,bold] %I:%M %p  \
#[fg=#fabd2f,bg=#282828]#[bg=#fabd2f,fg=#282828,bold]   #[bg=#282828,fg=#fabd2f,bold] %d-%b-%Y "


bind-key o run-shell 'bash -lc '"'"'
selection="$(sesh list --icons \
  | fzf-tmux -p 80%,70% \
  --no-sort --ansi --border-label " 󰆍 Sessions " \
  --prompt " ❯ " \
  --header "^a all ^t tmux ^x zoxide ^g configs | ^k delete" \
  --bind "ctrl-a:change-prompt( ❯ )+reload(sesh list --icons)" \
  --bind "ctrl-t:change-prompt(󰆍 ❯ )+reload(sesh list -t --icons)" \
  --bind "ctrl-x:change-prompt(󰉋 ❯ )+reload(sesh list -z --icons)" \
  --bind "ctrl-g:change-prompt( ❯ )+reload(sesh list -c --icons)" \
  --bind "ctrl-k:execute-silent(tmux kill-session -t {-1})+reload(sesh list --icons)" \
  --color "fg:#ebdbb2,bg:#282828,hl:#fabd2f,fg+:#ebdbb2,bg+:#3c3836,hl+:#fabd2f" \
  --color "info:#83a598,prompt:#bdae93,spinner:#fabd2f,pointer:#83a598,marker:#fe8019,header:#665c54" \
  --pointer "▶" --marker "✓" \
  --layout reverse --info inline \
  | awk "{print \$NF}")"
[ -n "$selection" ] && sesh connect "$selection" || true
'"'"''
